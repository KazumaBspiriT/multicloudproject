# ansible/playbook.yml

- name: Configure Kubernetes Cluster and Deploy Application
  hosts: localhost # We run Ansible locally against the cluster via kubectl
  connection: local
  gather_facts: no
  
  tasks:
    - name: Ensure environment is ready
      ansible.builtin.debug:
        msg: "Starting cluster configuration for deployment mode: {{ deployment_mode }}"

  roles:
    # Install AWS Load Balancer Controller for EKS ALB Ingress (only for AWS k8s with domain)
    - role: aws_alb_controller
      when: deployment_mode == "k8s" and 'aws' in (target_clouds | default('')).split(',') and domain_name | length > 0
    - sample_app