# ansible/roles/sample_app/tasks/main.yml

- name: Create application namespace
  kubernetes.core.k8s:
    name: sample-app
    api_version: v1
    kind: Namespace
    state: present

- name: Deploy sample application (Deployment and Service)
  kubernetes.core.k8s:
    state: present
    definition:
      apiVersion: apps/v1
      kind: Deployment
      metadata:
        name: portfolio-app
        namespace: sample-app
        labels:
          app: portfolio
      spec:
        replicas: 2
        selector:
          match_labels:
            app: portfolio
        template:
          metadata:
            labels:
              app: portfolio
          spec:
            containers:
            - name: simple-web
              image: nginx:latest # Replace with your actual portfolio container image
              ports:
              - container_port: 80

- name: Expose application via Ingress
  kubernetes.core.k8s:
    state: present
    definition:
      apiVersion: networking.k8s.io/v1
      kind: Ingress
      metadata:
        name: portfolio-ingress
        namespace: sample-app
        annotations:
          # Optional: Use AWS-specific annotation for Load Balancer scheme if needed
          # kubernetes.io/ingress.class: "nginx" # Specify the ingress class
      spec:
        rules:
        - http:
            paths:
            - path: /
              pathType: Prefix
              backend:
                service:
                  name: portfolio-service
                  port:
                    number: 80